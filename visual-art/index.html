<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†è§‰è‰ºæœ¯ - åˆ›ä½œæ”¶é›†å¹³å°</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="../index.html">åˆ›ä½œæ”¶é›†å¹³å°</a>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="../index.html">é¦–é¡µ</a></li>
                <li><a href="visual-art.html" class="active">è§†è§‰è‰ºæœ¯</a></li>
            </ul>
            <button class="nav-toggle" id="navToggle" aria-label="åˆ‡æ¢èœå•">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <button class="theme-toggle" id="themeToggle" aria-label="åˆ‡æ¢ä¸»é¢˜">
                <span class="theme-icon">ğŸŒ™</span>
            </button>
        </div>
    </nav>

    <!-- ä¸»è¦å†…å®¹ -->
    <main style="padding-top: var(--header-height); min-height: 100vh;">
        <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
        <div class="container" style="margin-top: 2rem;">
            <div class="tab-nav">
                <button class="tab-btn active" id="submitTab" onclick="switchTab('submit')">æäº¤ä½œå“</button>
                <button class="tab-btn" id="galleryTab" onclick="switchTab('gallery')">æµè§ˆç”»å»Š</button>
            </div>
        </div>

        <!-- æäº¤ä½œå“æ ‡ç­¾é¡µ -->
        <div id="submitPanel" class="tab-panel active">
            <section class="section">
                <div class="container">
                    <div class="contact-form-wrapper" style="max-width: 800px; margin: 0 auto;">
                        <h3>æäº¤è§†è§‰è‰ºæœ¯ä½œå“</h3>
                        <p>åˆ†äº«æ‚¨çš„AIç»˜ç”»ä½œå“å’Œæç¤ºè¯ï¼Œè®©æ›´å¤šäººæ¬£èµæ‚¨çš„åˆ›æ„ï¼</p>
                        
                        <form id="artSubmitForm" class="contact-form">
                            <div class="form-group">
                                <label for="prompt">AIæç¤ºè¯ *</label>
                                <textarea id="prompt" name="prompt" rows="4" required 
                                          placeholder="è¯·è¾“å…¥æ‚¨ä½¿ç”¨çš„AIç»˜ç”»æç¤ºè¯ï¼ˆpromptï¼‰ï¼Œè¿™æœ‰åŠ©äºå…¶ä»–åˆ›ä½œè€…å­¦ä¹ "></textarea>
                                <span class="error-message" id="promptError"></span>
                            </div>
                            
                            <!-- é™„åŠ ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰- å¯æŠ˜å åŒºåŸŸ -->
                            <div class="optional-fields-toggle">
                                <button type="button" class="toggle-btn" id="toggleOptionalBtn">
                                    <span class="toggle-icon">â–¼</span>
                                    <span class="toggle-text">é™„åŠ ä¿¡æ¯ï¼ˆé€‰å¡«ï¼‰</span>
                                </button>
                                <div class="optional-fields-content hidden" id="optionalFields">
                                    <div class="form-group">
                                        <label for="creatorName">åˆ›ä½œè€…å§“å</label>
                                        <input type="text" id="creatorName" name="creatorName" 
                                               placeholder="è¯·è¾“å…¥æ‚¨çš„å§“åæˆ–æ˜µç§°">
                                        <span class="error-message" id="creatorNameError"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="artTitle">ä½œå“æ ‡é¢˜</label>
                                        <input type="text" id="artTitle" name="artTitle" 
                                               placeholder="è¯·è¾“å…¥ä½œå“æ ‡é¢˜">
                                        <span class="error-message" id="artTitleError"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="aiModel">AIæ¨¡å‹</label>
                                        <select id="aiModel" name="aiModel" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--card-bg); color: var(--text-color);">
                                            <option value="">è¯·é€‰æ‹©ä½¿ç”¨çš„AIæ¨¡å‹</option>
                                            <option value="Midjourney">Midjourney</option>
                                            <option value="Stable Diffusion">Stable Diffusion</option>
                                            <option value="DALL-E">DALL-E</option>
                                            <option value="æ–‡å¿ƒä¸€æ ¼">æ–‡å¿ƒä¸€æ ¼</option>
                                            <option value="å…¶ä»–">å…¶ä»–</option>
                                        </select>
                                        <span class="error-message" id="aiModelError"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="artStyle">ä½œå“é£æ ¼</label>
                                        <input type="text" id="artStyle" name="artStyle" 
                                               placeholder="ä¾‹å¦‚ï¼šå†™å®ã€å¡é€šã€èµ›åšæœ‹å…‹ã€å›½é£ç­‰">
                                        <span class="error-message" id="artStyleError"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="description">åˆ›ä½œæè¿°</label>
                                        <textarea id="description" name="description" rows="3" 
                                                  placeholder="åˆ†äº«æ‚¨çš„åˆ›ä½œçµæ„Ÿã€åˆ›ä½œè¿‡ç¨‹æˆ–æƒ³è¦è¡¨è¾¾çš„æƒ…æ„Ÿ"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="artImage">ä¸Šä¼ ä½œå“å›¾ç‰‡ *</label>
                                <div class="upload-area" id="uploadArea">
                                    <div class="upload-content">
                                        <div class="upload-icon">ğŸ“·</div>
                                        <p>ç‚¹å‡»ä¸Šä¼ æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</p>
                                        <p style="font-size: 14px; color: var(--text-light); margin-top: 8px;">æ”¯æŒ JPG, PNG, WEBP æ ¼å¼ï¼Œæœ€å¤§ 5MB</p>
                                        <input type="file" id="artImage" name="artImage" accept="image/*" style="display: none;">
                                    </div>
                                </div>
                                <div class="preview-area hidden" id="previewArea">
                                    <img id="imagePreview" src="" alt="é¢„è§ˆ">
                                    <button type="button" class="remove-image" id="removeImage">Ã—</button>
                                </div>
                                <span class="error-message" id="artImageError"></span>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-full">
                                <span class="submit-text">æäº¤ä½œå“</span>
                                <span class="loading-text" style="display: none;">æäº¤ä¸­...</span>
                            </button>
                        </form>
                        
                        <!-- æˆåŠŸæ¶ˆæ¯ -->
                        <div class="success-message hidden" id="successMessage">
                            <h3>âœ… ä½œå“æäº¤æˆåŠŸï¼</h3>
                            <p>æ‚¨çš„è§†è§‰è‰ºæœ¯ä½œå“å·²æˆåŠŸæäº¤ï¼Œæ„Ÿè°¢æ‚¨çš„åˆ†äº«ï¼</p>
                            <button type="button" class="btn btn-primary" onclick="resetForm()">ç»§ç»­æäº¤</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- æµè§ˆç”»å»Šæ ‡ç­¾é¡µ -->
        <div id="galleryPanel" class="tab-panel">
            <section class="section">
                <div class="container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 class="section-title" style="margin-bottom: 0;">ä½œå“ç”»å»Š</h2>
                        <div class="gallery-controls">
                            <input type="text" id="searchInput" placeholder="æœç´¢ä½œå“..." style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--card-bg); color: var(--text-color);">
                            <select id="styleFilter" style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--card-bg); color: var(--text-color); margin-left: 10px;">
                                <option value="">æ‰€æœ‰é£æ ¼</option>
                                <option value="å†™å®">å†™å®</option>
                                <option value="å¡é€š">å¡é€š</option>
                                <option value="èµ›åšæœ‹å…‹">èµ›åšæœ‹å…‹</option>
                                <option value="å›½é£">å›½é£</option>
                                <option value="æŠ½è±¡">æŠ½è±¡</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="galleryGrid" class="gallery-grid">
                        <div class="loading">æ­£åœ¨åŠ è½½ä½œå“...</div>
                    </div>
                    
                    <div id="noResults" class="no-results hidden">
                        <p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ä½œå“</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- å›¾ç‰‡æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div id="imageModal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <img id="modalImage" src="" alt="ä½œå“">
            <div class="modal-info">
                <h3 id="modalTitle"></h3>
                <p><strong>åˆ›ä½œè€…ï¼š</strong><span id="modalCreator"></span></p>
                <p><strong>AIæ¨¡å‹ï¼š</strong><span id="modalModel"></span></p>
                <p><strong>ä½œå“é£æ ¼ï¼š</strong><span id="modalStyle"></span></p>
                <div class="prompt-section">
                    <h4>AIæç¤ºè¯ï¼š</h4>
                    <div class="prompt-box" id="modalPrompt"></div>
                </div>
                <div class="description-section" id="modalDescriptionSection">
                    <h4>åˆ›ä½œæè¿°ï¼š</h4>
                    <p id="modalDescription"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Supabase åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    
    <!-- JavaScript -->
    <script src="../script.js"></script>
    
    <script>
        // è§†è§‰è‰ºæœ¯é¡µé¢ï¼šå®Œå…¨ç‹¬ç«‹çš„å›¾ç‰‡åŠ è½½å’Œæ¸²æŸ“
        (async function initVisualArtGallery() {
            console.log('ğŸ¨ åˆå§‹åŒ–è§†è§‰è‰ºæœ¯ç”»å»Š...');
            
            const SUPABASE_URL = 'https://oylnjffrjdjaooeaqtvl.supabase.co';
            const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im95bG5qZmZyamRqYW9vZWFxdHZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk3NTAwMDMsImV4cCI6MjA4NTMyNjAwM30.1V70qcXvATKaBCVtK9sdLGK7-l2cxa4muLonpVGmiM8';
            
            // åˆ›å»º Supabase å®¢æˆ·ç«¯
            const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            console.log('âœ… Supabase å®¢æˆ·ç«¯å·²åˆ›å»º');
            
            // è·å–ç”»å»Šå®¹å™¨
            const galleryGrid = document.getElementById('galleryGrid');
            if (!galleryGrid) {
                console.error('âŒ æ‰¾ä¸åˆ°ç”»å»Šå®¹å™¨');
                return;
            }
            
            // åŠ è½½å¹¶æ¸²æŸ“ç”»å»Š
            async function loadAndRenderGallery() {
                try {
                    console.log('ğŸ“Š å¼€å§‹åŠ è½½ä½œå“æ•°æ®...');
                    
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    galleryGrid.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½ä½œå“...</div>';
                    
                    // ä» Supabase åŠ è½½ä½œå“ï¼ˆåªæ˜¾ç¤ºå·²é€šè¿‡çš„ä½œå“ï¼‰
                    const { data: artworks, error } = await supabaseClient
                        .from('artworks')
                        .select('*')
                        .eq('status', 'approved')
                        .order('created_at', { ascending: false });
                    
                    if (error) {
                        throw new Error('æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: ' + error.message);
                    }
                    
                    if (!artworks || artworks.length === 0) {
                        galleryGrid.innerHTML = '<div class="no-results"><p>æš‚æ— ä½œå“ï¼Œå¿«æ¥æäº¤ç¬¬ä¸€ä¸ªä½œå“å§ï¼</p></div>';
                        console.log('â„¹ï¸ æ²¡æœ‰æ‰¾åˆ°ä½œå“');
                        return;
                    }
                    
                    console.log('âœ… æˆåŠŸè·å–', artworks.length, 'æ¡è®°å½•');
                    console.log('ç¬¬ä¸€æ¡è®°å½•:', artworks[0]);
                    
                    // æ¸²æŸ“ç”»å»Š
                    const html = artworks.map(artwork => `
                        <div class="gallery-item" onclick="openModal('${artwork.id}')">
                            <img src="${artwork.image_url}" alt="${artwork.art_title || 'ä½œå“'}" loading="lazy" onerror="this.style.display='none'; console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', '${artwork.image_url}')">
                            <div class="gallery-item-info">
                                <div class="gallery-item-title">${artwork.art_title || 'æœªå‘½åä½œå“'}</div>
                                <div class="gallery-item-creator">by ${artwork.creator_name || 'åŒ¿ååˆ›ä½œè€…'}</div>
                                <div class="gallery-item-style">${artwork.art_style || ''}</div>
                                <div class="gallery-item-model">${artwork.ai_model || 'æœªçŸ¥æ¨¡å‹'}</div>
                            </div>
                        </div>
                    `).join('');
                    
                    galleryGrid.innerHTML = html;
                    console.log('âœ… æˆåŠŸæ¸²æŸ“', artworks.length, 'å¼ å›¾ç‰‡');
                    
                    // éªŒè¯æ¸²æŸ“ç»“æœ
                    setTimeout(() => {
                        const items = galleryGrid.querySelectorAll('.gallery-item');
                        console.log('ğŸ“Š æ¸²æŸ“éªŒè¯:', items.length, 'ä¸ª item');
                        
                        if (items.length !== artworks.length) {
                            console.error('âŒ æ¸²æŸ“æ•°é‡ä¸åŒ¹é…:', items.length, '!==', artworks.length);
                        }
                    }, 100);
                    
                } catch (error) {
                    console.error('âŒ åŠ è½½å¤±è´¥:', error);
                    galleryGrid.innerHTML = '<div class="error"><p>âŒ åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p></div>';
                }
            }
            
            // ç«‹å³åŠ è½½æ¸²æŸ“
            loadAndRenderGallery();
            
            console.log('âœ… è§†è§‰è‰ºæœ¯ç”»å»Šåˆå§‹åŒ–å®Œæˆ');
        })();
    </script>
</body>
</html>
