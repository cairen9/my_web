<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视觉艺术 - 创作收集平台</title>
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="../index.html">创作收集平台</a>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="../index.html">首页</a></li>
                <li><a href="visual-art.html" class="active">视觉艺术</a></li>
            </ul>
            <button class="nav-toggle" id="navToggle" aria-label="切换菜单">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <button class="theme-toggle" id="themeToggle" aria-label="切换主题">
                <span class="theme-icon">🌙</span>
            </button>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main style="padding-top: var(--header-height); min-height: 100vh;">
        <!-- 标签页切换 -->
        <div class="container" style="margin-top: 2rem;">
            <div class="tab-nav">
                <button class="tab-btn active" id="submitTab" onclick="switchTab('submit')">提交作品</button>
                <button class="tab-btn" id="galleryTab" onclick="switchTab('gallery')">浏览画廊</button>
            </div>
        </div>

        <!-- 提交作品标签页 -->
        <div id="submitPanel" class="tab-panel active">
            <section class="section">
                <div class="container">
                    <div class="contact-form-wrapper" style="max-width: 800px; margin: 0 auto;">
                        <h3>提交视觉艺术作品</h3>
                        <p>分享您的AI绘画作品和提示词，让更多人欣赏您的创意！</p>
                        
                        <form id="artSubmitForm" class="contact-form">
                            <div class="form-group">
                                <label for="prompt">AI提示词 *</label>
                                <textarea id="prompt" name="prompt" rows="4" required 
                                          placeholder="请输入您使用的AI绘画提示词（prompt），这有助于其他创作者学习"></textarea>
                                <span class="error-message" id="promptError"></span>
                            </div>
                            
                            <!-- 附加信息（选填）- 可折叠区域 -->
                            <div class="optional-fields-toggle">
                                <button type="button" class="toggle-btn" id="toggleOptionalBtn">
                                    <span class="toggle-icon">▼</span>
                                    <span class="toggle-text">附加信息（选填）</span>
                                </button>
                                <div class="optional-fields-content hidden" id="optionalFields">
                                    <div class="form-group">
                                        <label for="creatorName">创作者姓名</label>
                                        <input type="text" id="creatorName" name="creatorName" 
                                               placeholder="请输入您的姓名或昵称">
                                        <span class="error-message" id="creatorNameError"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="artTitle">作品标题</label>
                                        <input type="text" id="artTitle" name="artTitle" 
                                               placeholder="请输入作品标题">
                                        <span class="error-message" id="artTitleError"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="aiModel">AI模型</label>
                                        <select id="aiModel" name="aiModel" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--card-bg); color: var(--text-color);">
                                            <option value="">请选择使用的AI模型</option>
                                            <option value="Midjourney">Midjourney</option>
                                            <option value="Stable Diffusion">Stable Diffusion</option>
                                            <option value="DALL-E">DALL-E</option>
                                            <option value="文心一格">文心一格</option>
                                            <option value="其他">其他</option>
                                        </select>
                                        <span class="error-message" id="aiModelError"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="artStyle">作品风格</label>
                                        <input type="text" id="artStyle" name="artStyle" 
                                               placeholder="例如：写实、卡通、赛博朋克、国风等">
                                        <span class="error-message" id="artStyleError"></span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="description">创作描述</label>
                                        <textarea id="description" name="description" rows="3" 
                                                  placeholder="分享您的创作灵感、创作过程或想要表达的情感"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="artImage">上传作品图片 *</label>
                                <div class="upload-area" id="uploadArea">
                                    <div class="upload-content">
                                        <div class="upload-icon">📷</div>
                                        <p>点击上传或拖拽图片到此处</p>
                                        <p style="font-size: 14px; color: var(--text-light); margin-top: 8px;">支持 JPG, PNG, WEBP 格式，最大 5MB</p>
                                        <input type="file" id="artImage" name="artImage" accept="image/*" style="display: none;">
                                    </div>
                                </div>
                                <div class="preview-area hidden" id="previewArea">
                                    <img id="imagePreview" src="" alt="预览">
                                    <button type="button" class="remove-image" id="removeImage">×</button>
                                </div>
                                <span class="error-message" id="artImageError"></span>
                            </div>
                            
                            <button type="submit" class="btn btn-primary btn-full">
                                <span class="submit-text">提交作品</span>
                                <span class="loading-text" style="display: none;">提交中...</span>
                            </button>
                        </form>
                        
                        <!-- 成功消息 -->
                        <div class="success-message hidden" id="successMessage">
                            <h3>✅ 作品提交成功！</h3>
                            <p>您的视觉艺术作品已成功提交，感谢您的分享！</p>
                            <button type="button" class="btn btn-primary" onclick="resetForm()">继续提交</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- 浏览画廊标签页 -->
        <div id="galleryPanel" class="tab-panel">
            <section class="section">
                <div class="container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h2 class="section-title" style="margin-bottom: 0;">作品画廊</h2>
                        <div class="gallery-controls">
                            <input type="text" id="searchInput" placeholder="搜索作品..." style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--card-bg); color: var(--text-color);">
                            <select id="styleFilter" style="padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--card-bg); color: var(--text-color); margin-left: 10px;">
                                <option value="">所有风格</option>
                                <option value="写实">写实</option>
                                <option value="卡通">卡通</option>
                                <option value="赛博朋克">赛博朋克</option>
                                <option value="国风">国风</option>
                                <option value="抽象">抽象</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="galleryGrid" class="gallery-grid">
                        <div class="loading">正在加载作品...</div>
                    </div>
                    
                    <div id="noResults" class="no-results hidden">
                        <p>没有找到符合条件的作品</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- 图片查看模态框 -->
    <div id="imageModal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <img id="modalImage" src="" alt="作品">
            <div class="modal-info">
                <h3 id="modalTitle"></h3>
                <p><strong>创作者：</strong><span id="modalCreator"></span></p>
                <p><strong>AI模型：</strong><span id="modalModel"></span></p>
                <p><strong>作品风格：</strong><span id="modalStyle"></span></p>
                <div class="prompt-section">
                    <h4>AI提示词：</h4>
                    <div class="prompt-box" id="modalPrompt"></div>
                </div>
                <div class="description-section" id="modalDescriptionSection">
                    <h4>创作描述：</h4>
                    <p id="modalDescription"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../script.js"></script>
    <script>
        // 视觉艺术页面专用脚本
        if (window.location.pathname.includes('visual-art')) {
            // 等待 Supabase 初始化完成的函数
            function waitForSupabase() {
                if (window.supabaseClient) {
                    // Supabase 已初始化
                    initVisualArtPage();
                } else if (window.supabaseInitPromise) {
                    // 使用 Promise 等待初始化
                    window.supabaseInitPromise.then(() => {
                        initVisualArtPage();
                    }).catch(error => {
                        console.error('Supabase 初始化失败:', error);
                    });
                } else {
                    // 还未准备好，继续等待
                    setTimeout(waitForSupabase, 100);
                }
            }
            
            // 开始等待
            waitForSupabase();
        }
    </script>
</body>
</html>
